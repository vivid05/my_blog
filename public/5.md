# Git åˆ†æ”¯åˆå¹¶è‡ªåŠ¨åŒ–å·¥å…·

> ä¸€ä¸ªé«˜æ•ˆã€å®‰å…¨çš„ Git åˆ†æ”¯åˆå¹¶è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæ”¯æŒå¤šç¯å¢ƒé…ç½®ã€æ¼”ç»ƒæ¨¡å¼å’Œè¯¦ç»†çš„æ“ä½œæ—¥å¿—ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ **è‡ªåŠ¨åŒ–åˆå¹¶æµç¨‹** - ä¸€é”®å®Œæˆåˆ†æ”¯åˆå¹¶åˆ°ç›®æ ‡ç¯å¢ƒ
- ğŸ¯ **å¤šç¯å¢ƒæ”¯æŒ** - æ”¯æŒå¼€å‘ã€æµ‹è¯•ç­‰å¤šä¸ªç¯å¢ƒé…ç½®
- ğŸ›¡ï¸ **å®‰å…¨æ“ä½œ** - å†…ç½®å®‰å…¨æ£€æŸ¥å’Œè‡ªåŠ¨æ¸…ç†æœºåˆ¶
- ğŸ­ **æ¼”ç»ƒæ¨¡å¼** - é¢„è§ˆæ“ä½œè€Œä¸æ‰§è¡Œå®é™…å‘½ä»¤
- ğŸ“ **è¯¦ç»†æ—¥å¿—** - å½©è‰²è¾“å‡ºå’Œè¯¦ç»†çš„æ“ä½œè®°å½•
- âš™ï¸ **çµæ´»é…ç½®** - JSON é…ç½®æ–‡ä»¶ï¼Œæ”¯æŒè‡ªå®šä¹‰ç¯å¢ƒå’Œç­–ç•¥
- ğŸš« **é”™è¯¯æ¢å¤** - å¼‚å¸¸æƒ…å†µä¸‹è‡ªåŠ¨åˆ‡æ¢å›åŸå§‹åˆ†æ”¯
- ğŸ“Š **çŠ¶æ€æ£€æŸ¥** - æ™ºèƒ½æ£€æµ‹ Git ä»“åº“çŠ¶æ€å’Œåˆ†æ”¯å˜æ›´

### åŸºæœ¬ä½¿ç”¨

```bash
# äº¤äº’æ¨¡å¼
./git_optimized.sh

# è‡ªåŠ¨æ¨¡å¼
./git_optimized.sh -a -e 1 -c "ä¿®å¤ç™»å½•bug"
```

## ğŸ“– è¯¦ç»†ç”¨æ³•

### å‘½ä»¤è¡Œé€‰é¡¹

| é€‰é¡¹     | é•¿é€‰é¡¹         | æè¿°                       |
| -------- | -------------- | -------------------------- |
| `-h`     | `--help`       | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯               |
| `-v`     | `--verbose`    | è¯¦ç»†æ¨¡å¼è¾“å‡º               |
| `-d`     | `--dry-run`    | æ¼”ç»ƒæ¨¡å¼ï¼ˆä¸æ‰§è¡Œå®é™…æ“ä½œï¼‰ |
| `-a`     | `--auto`       | è‡ªåŠ¨æ¨¡å¼ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰     |
| `-c MSG` | `--commit MSG` | æŒ‡å®šæäº¤ä¿¡æ¯               |
| `-e ENV` | `--env ENV`    | æŒ‡å®šç›®æ ‡ç¯å¢ƒ (0-3)         |
|          | `--config`     | ç¼–è¾‘é…ç½®æ–‡ä»¶               |
|          | `--list-envs`  | åˆ—å‡ºå¯ç”¨ç¯å¢ƒ               |
|          | `--version`    | æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯               |

### å·¥ä½œæµç¨‹

1. **æ£€æŸ¥ Git çŠ¶æ€** - éªŒè¯ä»“åº“çŠ¶æ€å’Œæœªæäº¤æ›´æ”¹
2. **æäº¤å½“å‰æ›´æ”¹** - è‡ªåŠ¨æ·»åŠ å¹¶æäº¤å·¥ä½œç›®å½•ä¸­çš„æ›´æ”¹
3. **æ¨é€æºåˆ†æ”¯** - å°†å½“å‰åˆ†æ”¯æ¨é€åˆ°è¿œç¨‹ä»“åº“
4. **åˆ‡æ¢ç›®æ ‡åˆ†æ”¯** - å®‰å…¨åˆ‡æ¢åˆ°æŒ‡å®šçš„ç›®æ ‡åˆ†æ”¯
5. **æ‹‰å–æœ€æ–°ä»£ç ** - è·å–ç›®æ ‡åˆ†æ”¯çš„æœ€æ–°æ›´æ”¹
6. **æ‰§è¡Œåˆå¹¶æ“ä½œ** - å°†æºåˆ†æ”¯åˆå¹¶åˆ°ç›®æ ‡åˆ†æ”¯
7. **æ¨é€åˆå¹¶ç»“æœ** - å°†åˆå¹¶åçš„ä»£ç æ¨é€åˆ°è¿œç¨‹
8. **æ¢å¤åŸåˆ†æ”¯** - åˆ‡æ¢å›åŸå§‹å·¥ä½œåˆ†æ”¯

## âš™ï¸ é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä½ç½®ï¼š`~/.git-merge-config.json`

### é»˜è®¤é…ç½®ç»“æ„

```json
{
  "environments": {
    "0": {
      "name": "develop (H5)",
      "branch": "develop"
    },
    "1": {
      "name": "æµ‹è¯•ç¯å¢ƒ1",
      "branch": "sprint/hwsocial_test1"
    },
    "2": {
      "name": "æµ‹è¯•ç¯å¢ƒ2",
      "branch": "sprint/hwsocial_test2"
    },
    "3": {
      "name": "æµ‹è¯•ç¯å¢ƒ3",
      "branch": "sprint/hwsocial_test3"
    }
  },
  "default_commit_format": "æ›´æ–°: %Y-%m-%d %H:%M",
  "auto_push": true,
  "merge_strategy": "no-edit"
}
```

### é…ç½®é¡¹è¯´æ˜

| é…ç½®é¡¹                  | ç±»å‹    | æè¿°                               |
| ----------------------- | ------- | ---------------------------------- |
| `environments`          | Object  | ç¯å¢ƒé…ç½®æ˜ å°„                       |
| `default_commit_format` | String  | é»˜è®¤æäº¤ä¿¡æ¯æ ¼å¼ï¼ˆæ”¯æŒ date æ ¼å¼ï¼‰ |
| `auto_push`             | Boolean | æ˜¯å¦è‡ªåŠ¨æ¨é€åˆ°è¿œç¨‹                 |
| `merge_strategy`        | String  | åˆå¹¶ç­–ç•¥ (`no-edit`, `squash`)     |

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### äº¤äº’æ¨¡å¼

```bash
./git_optimized.sh
```

è„šæœ¬ä¼šå¼•å¯¼æ‚¨é€‰æ‹©ç¯å¢ƒå’Œè¾“å…¥æäº¤ä¿¡æ¯ã€‚

### å¿«é€Ÿåˆå¹¶åˆ°æµ‹è¯•ç¯å¢ƒ 1

```bash
./git_optimized.sh -e 1 -c "ä¿®å¤ç”¨æˆ·ç™»å½•bug"
```

### æ¼”ç»ƒæ¨¡å¼ï¼ˆé¢„è§ˆæ“ä½œï¼‰

```bash
./git_optimized.sh -d -e 0 -c "æ–°å¢åŠŸèƒ½"
```

### è¯¦ç»†è¾“å‡ºæ¨¡å¼

```bash
./git_optimized.sh -v -e 2 -c "æ›´æ–°ä¾èµ–åŒ…"
```

### è‡ªåŠ¨åŒ– CI/CD ä½¿ç”¨

```bash
./git_optimized.sh -a -e 1 -c "è‡ªåŠ¨éƒ¨ç½² $(date '+%Y-%m-%d %H:%M')"
```

### ç®¡ç†é…ç½®

```bash
# ç¼–è¾‘é…ç½®æ–‡ä»¶
./git_optimized.sh --config

# æŸ¥çœ‹å¯ç”¨ç¯å¢ƒ
./git_optimized.sh --list-envs

# æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯
./git_optimized.sh --version
```

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### 1. çŠ¶æ€æ£€æŸ¥

- éªŒè¯ Git ä»“åº“æœ‰æ•ˆæ€§
- æ£€æŸ¥æœªæäº¤çš„æ›´æ”¹
- ç¡®è®¤åˆ†æ”¯å­˜åœ¨æ€§

### 2. é”™è¯¯æ¢å¤

- å¼‚å¸¸é€€å‡ºæ—¶è‡ªåŠ¨åˆ‡æ¢å›åŸåˆ†æ”¯
- ä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨æ¸…ç†
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯è¾“å‡º

### 3. æ¼”ç»ƒæ¨¡å¼

- å®Œå…¨æ¨¡æ‹Ÿæ“ä½œæµç¨‹
- ä¸æ‰§è¡Œä»»ä½•å®é™…çš„ Git å‘½ä»¤
- å®‰å…¨çš„é¢„è§ˆåŠŸèƒ½

### 4. åˆ†æ”¯ä¿æŠ¤

- æ™ºèƒ½åˆ†æ”¯åˆ‡æ¢å’Œåˆ›å»º
- è¿œç¨‹åˆ†æ”¯è·Ÿè¸ª
- é˜²æ­¢æ„å¤–çš„åˆ†æ”¯æ“ä½œ

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q: æç¤º"éœ€è¦å®‰è£… jq"æ€ä¹ˆåŠï¼Ÿ**

```bash
# macOS
brew install jq

# Linux
sudo apt-get install jq  # Ubuntu/Debian
sudo yum install jq      # CentOS/RHEL
```

**Q: è„šæœ¬æ‰§è¡Œå¤±è´¥åå¦‚ä½•æ¢å¤ï¼Ÿ**

- è„šæœ¬ä¼šè‡ªåŠ¨å°è¯•åˆ‡æ¢å›åŸå§‹åˆ†æ”¯
- æ‰‹åŠ¨æ‰§è¡Œï¼š`git checkout <åŸå§‹åˆ†æ”¯å>`
- æ£€æŸ¥ Git çŠ¶æ€ï¼š`git status`

**Q: å¦‚ä½•é‡ç½®é…ç½®æ–‡ä»¶ï¼Ÿ**

```bash
rm ~/.git-merge-config.json
./git_optimized.sh --config
```

**Q: åˆå¹¶å†²çªæ€ä¹ˆå¤„ç†ï¼Ÿ**

- è„šæœ¬ä¼šæš‚åœå¹¶æ˜¾ç¤ºå†²çªä¿¡æ¯
- æ‰‹åŠ¨è§£å†³å†²çªåè¿è¡Œï¼š`git add . && git commit`
- ç„¶åé‡æ–°è¿è¡Œè„šæœ¬

### è°ƒè¯•æ¨¡å¼

```bash
# ä½¿ç”¨è¯¦ç»†è¾“å‡ºæ¨¡å¼
./git_optimized.sh -v

# ç»“åˆæ¼”ç»ƒæ¨¡å¼è°ƒè¯•
./git_optimized.sh -d -v -e 1
```

## ğŸ“ å®Œæ•´æºä»£ç 

> **ğŸ’¡ æç¤º**: å®Œæ•´çš„ 488 è¡Œæºä»£ç å¦‚ä¸‹ï¼Œæ‚¨å¯ä»¥å¤åˆ¶åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ä½¿ç”¨ã€‚

<details>
<summary><strong>ğŸ“– ç‚¹å‡»è¿™é‡Œå±•å¼€/æŠ˜å å®Œæ•´æºä»£ç </strong></summary>

<br>

**æ–‡ä»¶å**: `git_optimized.sh`

```bash
#!/bin/bash

# ===================================
# Git åˆ†æ”¯åˆå¹¶è‡ªåŠ¨åŒ–å·¥å…· (ä¼˜åŒ–ç‰ˆæœ¬)
# ===================================

# è®¾ç½®ä¸¥æ ¼æ¨¡å¼
set -euo pipefail

# è„šæœ¬ç‰ˆæœ¬
readonly SCRIPT_VERSION="2.0.0"

# é…ç½®æ–‡ä»¶è·¯å¾„
readonly CONFIG_FILE="${HOME}/.git-merge-config.json"

# ä¸´æ—¶æ–‡ä»¶è·Ÿè¸ª
TEMP_FILES=()
trap cleanup EXIT

# é¢œè‰²å®šä¹‰
readonly RED='\033[0;31m'
readonly GREEN='\033[0;32m'
readonly YELLOW='\033[0;33m'
readonly BLUE='\033[1;36m'
readonly PURPLE='\033[0;35m'
readonly CYAN='\033[0;36m'
readonly NC='\033[0m' # æ— é¢œè‰²

# å…¨å±€å˜é‡
ORIGINAL_BRANCH=""
TEMP_BRANCH=""
DRY_RUN=false
VERBOSE=false
AUTO_MODE=false
COMMIT_MSG=""
TARGET_ENV=""

# ===================================
# å·¥å…·å‡½æ•°
# ===================================

# æ¸…ç†å‡½æ•°
cleanup() {
    local exit_code=$?

    # æ¸…ç†ä¸´æ—¶æ–‡ä»¶
    if [[ ${#TEMP_FILES[@]} -gt 0 ]]; then
        for temp_file in "${TEMP_FILES[@]}"; do
            [[ -f "$temp_file" ]] && rm -f "$temp_file"
        done
    fi

    # å¦‚æœæ˜¯å¼‚å¸¸é€€å‡ºä¸”ä¸åœ¨åŸå§‹åˆ†æ”¯ï¼Œå°è¯•åˆ‡æ¢å›å»
    if [[ $exit_code -ne 0 && -n "$ORIGINAL_BRANCH" ]]; then
        local current_branch
        current_branch=$(git branch --show-current 2>/dev/null || echo "")
        if [[ "$current_branch" != "$ORIGINAL_BRANCH" ]]; then
            echo -e "${YELLOW}[æ¸…ç†]${NC} å°è¯•åˆ‡æ¢å›åŸå§‹åˆ†æ”¯: $ORIGINAL_BRANCH" >&2
            git checkout "$ORIGINAL_BRANCH" 2>/dev/null || true
        fi
    fi

    exit $exit_code
}

# è¾“å‡ºå‡½æ•°
print_message() {
    echo -e "${CYAN}[INFO]${NC} $1"
}

print_success() {
    echo -e "${GREEN}[æˆåŠŸ]${NC} $1"
}

print_error() {
    echo -e "${RED}[é”™è¯¯]${NC} $1" >&2
}

print_warning() {
    echo -e "${YELLOW}[è­¦å‘Š]${NC} $1"
}

print_debug() {
    if [[ "$VERBOSE" == true ]]; then
        echo -e "${PURPLE}[è°ƒè¯•]${NC} $1" >&2
    fi
}

# å®‰å…¨çš„å‘½ä»¤æ‰§è¡Œå‡½æ•°
safe_run() {
    local cmd=("$@")
    local temp_file
    temp_file=$(mktemp)
    TEMP_FILES+=("$temp_file")

    print_debug "æ‰§è¡Œå‘½ä»¤: ${cmd[*]}"

    if [[ "$DRY_RUN" == true ]]; then
        print_warning "[æ¼”ç»ƒæ¨¡å¼] å°†è¦æ‰§è¡Œ: ${cmd[*]}"
        return 0
    fi

    # æ‰§è¡Œå‘½ä»¤å¹¶æ•è·è¾“å‡º
    if "${cmd[@]}" > "$temp_file" 2>&1; then
        if [[ "$VERBOSE" == true ]]; then
            cat "$temp_file"
        fi
        return 0
    else
        local exit_code=$?
        print_error "å‘½ä»¤æ‰§è¡Œå¤±è´¥: ${cmd[*]}"
        print_error "é”™è¯¯è¯¦æƒ…:"
        cat "$temp_file" >&2
        return $exit_code
    fi
}

# åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶
create_default_config() {
    cat > "$CONFIG_FILE" << 'EOF'
{
  "environments": {
    "0": {
      "name": "develop (H5)",
      "branch": "develop"
    },
    "1": {
      "name": "æµ‹è¯•ç¯å¢ƒ1",
      "branch": "sprint/hwsocial_test1"
    },
    "2": {
      "name": "æµ‹è¯•ç¯å¢ƒ2",
      "branch": "sprint/hwsocial_test2"
    },
    "3": {
      "name": "æµ‹è¯•ç¯å¢ƒ3",
      "branch": "sprint/hwsocial_test3"
    }
  },
  "default_commit_format": "æ›´æ–°: %Y-%m-%d %H:%M",
  "auto_push": true,
  "merge_strategy": "no-edit"
}
EOF
    print_success "å·²åˆ›å»ºé»˜è®¤é…ç½®æ–‡ä»¶: $CONFIG_FILE"
}

# è¯»å–é…ç½®
load_config() {
    if [[ ! -f "$CONFIG_FILE" ]]; then
        print_warning "é…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºé»˜è®¤é…ç½®"
        create_default_config
    fi

    # æ£€æŸ¥ jq æ˜¯å¦å¯ç”¨
    if ! command -v jq >/dev/null 2>&1; then
        print_error "éœ€è¦å®‰è£… jq æ¥è§£æé…ç½®æ–‡ä»¶"
        print_message "è¯·è¿è¡Œ: brew install jq (macOS) æˆ– apt-get install jq (Ubuntu)"
        exit 1
    fi
}

# è·å–ç¯å¢ƒåˆ—è¡¨
get_environments() {
    jq -r '.environments | to_entries[] | "\(.key) - \(.value.name)"' "$CONFIG_FILE"
}

# è·å–åˆ†æ”¯åç§°
get_branch_name() {
    local env_key="$1"
    jq -r ".environments[\"$env_key\"].branch" "$CONFIG_FILE"
}

# éªŒè¯Gitä»“åº“
validate_git_repo() {
    if ! git rev-parse --is-inside-work-tree >/dev/null 2>&1; then
        print_error "å½“å‰ç›®å½•ä¸æ˜¯Gitä»“åº“"
        exit 1
    fi

    # æ£€æŸ¥æ˜¯å¦æœ‰è¿œç¨‹ä»“åº“
    if ! git remote get-url origin >/dev/null 2>&1; then
        print_warning "æ²¡æœ‰é…ç½®originè¿œç¨‹ä»“åº“"
    fi
}

# æ£€æŸ¥GitçŠ¶æ€
check_git_status() {
    local status
    status=$(git status --porcelain)

    if [[ -n "$status" ]]; then
        print_message "æ£€æµ‹åˆ°æœªæäº¤çš„æ›´æ”¹:"
        git status --short
        return 1
    else
        print_message "å·¥ä½œç›®å½•æ˜¯å¹²å‡€çš„"
        return 0
    fi
}

# æ£€æŸ¥åˆ†æ”¯æ˜¯å¦å­˜åœ¨
branch_exists() {
    local branch_name="$1"
    local location="$2" # local æˆ– remote

    case "$location" in
        local)
            git show-ref --verify --quiet "refs/heads/$branch_name"
            ;;
        remote)
            git show-ref --verify --quiet "refs/remotes/origin/$branch_name"
            ;;
        *)
            print_error "æ— æ•ˆçš„ä½ç½®å‚æ•°: $location"
            return 1
            ;;
    esac
}

# å®‰å…¨çš„åˆ†æ”¯åˆ‡æ¢
safe_checkout() {
    local branch_name="$1"
    local create_if_missing="${2:-false}"

    print_message "åˆ‡æ¢åˆ°åˆ†æ”¯: $branch_name"

    if branch_exists "$branch_name" "local"; then
        safe_run git checkout "$branch_name"
    elif branch_exists "$branch_name" "remote" && [[ "$create_if_missing" == true ]]; then
        print_message "åˆ›å»ºæœ¬åœ°åˆ†æ”¯å¹¶è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯"
        safe_run git checkout -b "$branch_name" "origin/$branch_name"
    else
        print_error "åˆ†æ”¯ $branch_name ä¸å­˜åœ¨"
        return 1
    fi
}

# å®‰å…¨çš„åˆ†æ”¯åˆå¹¶
safe_merge() {
    local source_branch="$1"
    local strategy="${2:-no-edit}"

    print_message "åˆå¹¶åˆ†æ”¯ $source_branch åˆ°å½“å‰åˆ†æ”¯"

    case "$strategy" in
        no-edit)
            safe_run git merge --no-edit "$source_branch"
            ;;
        squash)
            safe_run git merge --squash "$source_branch"
            ;;
        *)
            print_error "ä¸æ”¯æŒçš„åˆå¹¶ç­–ç•¥: $strategy"
            return 1
            ;;
    esac
}

# æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
show_help() {
    cat << EOF
Git åˆ†æ”¯åˆå¹¶è‡ªåŠ¨åŒ–å·¥å…· v$SCRIPT_VERSION

ç”¨æ³•: $0 [é€‰é¡¹]

é€‰é¡¹:
    -h, --help          æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯
    -v, --verbose       è¯¦ç»†æ¨¡å¼
    -d, --dry-run       æ¼”ç»ƒæ¨¡å¼ï¼ˆä¸æ‰§è¡Œå®é™…æ“ä½œï¼‰
    -a, --auto          è‡ªåŠ¨æ¨¡å¼ï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
    -c, --commit MSG    æŒ‡å®šæäº¤ä¿¡æ¯
    -e, --env ENV       æŒ‡å®šç›®æ ‡ç¯å¢ƒ (0-3)
    --config            ç¼–è¾‘é…ç½®æ–‡ä»¶
    --list-envs         åˆ—å‡ºå¯ç”¨ç¯å¢ƒ
    --version           æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

ç¤ºä¾‹:
    $0                          # äº¤äº’æ¨¡å¼
    $0 -e 1 -c "ä¿®å¤bug"        # åˆå¹¶åˆ°æµ‹è¯•ç¯å¢ƒ1
    $0 -d -e 0                  # æ¼”ç»ƒæ¨¡å¼åˆå¹¶åˆ°develop
    $0 --config                 # ç¼–è¾‘é…ç½®æ–‡ä»¶

é…ç½®æ–‡ä»¶ä½ç½®: $CONFIG_FILE
EOF
}

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
show_version() {
    echo "Git åˆ†æ”¯åˆå¹¶è‡ªåŠ¨åŒ–å·¥å…· v$SCRIPT_VERSION"
}

# ç¼–è¾‘é…ç½®æ–‡ä»¶
edit_config() {
    local editor="${EDITOR:-vi}"

    if [[ ! -f "$CONFIG_FILE" ]]; then
        create_default_config
    fi

    print_message "ä½¿ç”¨ $editor ç¼–è¾‘é…ç½®æ–‡ä»¶..."
    "$editor" "$CONFIG_FILE"
}

# åˆ—å‡ºç¯å¢ƒ
list_environments() {
    print_message "å¯ç”¨ç¯å¢ƒ:"
    get_environments | while read -r env; do
        echo -e "  ${YELLOW}$env${NC}"
    done
}

# è·å–ç”¨æˆ·è¾“å…¥
get_user_input() {
    if [[ "$AUTO_MODE" == true ]]; then
        return 0
    fi

    # è·å–æäº¤ä¿¡æ¯
    if [[ -z "$COMMIT_MSG" ]]; then
        echo -e "${BLUE}è¯·è¾“å…¥æäº¤ä¿¡æ¯ (ç•™ç©ºä½¿ç”¨é»˜è®¤ä¿¡æ¯):${NC}"
        read -r COMMIT_MSG

        if [[ -z "$COMMIT_MSG" ]]; then
            local format
            format=$(jq -r '.default_commit_format' "$CONFIG_FILE")
            COMMIT_MSG=$(date +"$format")
            print_message "ä½¿ç”¨é»˜è®¤æäº¤ä¿¡æ¯: \"$COMMIT_MSG\""
        fi
    fi

    # è·å–ç›®æ ‡ç¯å¢ƒ
    if [[ -z "$TARGET_ENV" ]]; then
        echo -e "${BLUE}è¯·è¾“å…¥è¦åˆå¹¶çš„ç›®æ ‡ç¯å¢ƒ:${NC}"
        get_environments | while read -r env; do
            echo -e "  ${YELLOW}$env${NC}"
        done
        read -r TARGET_ENV
    fi

    # éªŒè¯ç¯å¢ƒé€‰æ‹©
    local available_envs
    available_envs=$(jq -r '.environments | keys[]' "$CONFIG_FILE")
    if ! echo "$available_envs" | grep -q "^$TARGET_ENV$"; then
        print_error "æ— æ•ˆçš„ç¯å¢ƒé€‰æ‹©: $TARGET_ENV"
        exit 1
    fi
}

# æ˜¾ç¤ºæ“ä½œæ‘˜è¦
show_summary() {
    local target_branch
    target_branch=$(get_branch_name "$TARGET_ENV")

    echo -e "${YELLOW}======================================${NC}"
    print_message "æ“ä½œæ‘˜è¦:"
    echo -e "  æºåˆ†æ”¯: ${YELLOW}$ORIGINAL_BRANCH${NC}"
    echo -e "  ç›®æ ‡åˆ†æ”¯: ${YELLOW}$target_branch${NC}"
    echo -e "  æäº¤ä¿¡æ¯: ${YELLOW}$COMMIT_MSG${NC}"
    echo -e "  æ¨¡å¼: ${YELLOW}$([ "$DRY_RUN" == true ] && echo "æ¼”ç»ƒæ¨¡å¼" || echo "æ‰§è¡Œæ¨¡å¼")${NC}"
    echo -e "${YELLOW}======================================${NC}"

    # è‡ªåŠ¨æ‰§è¡Œï¼Œæ— éœ€ç¡®è®¤
    print_message "è‡ªåŠ¨æ‰§è¡Œä¸Šè¿°æ“ä½œ..."
}

# ä¸»è¦çš„åˆå¹¶é€»è¾‘
execute_merge() {
    local target_branch
    target_branch=$(get_branch_name "$TARGET_ENV")

    print_message "å¼€å§‹æ‰§è¡Œåˆå¹¶æ“ä½œ..."

    # 1. æ£€æŸ¥å¹¶æäº¤å½“å‰æ›´æ”¹
    if ! check_git_status; then
        print_message "æ·»åŠ å¹¶æäº¤å½“å‰æ›´æ”¹..."
        safe_run git add .
        safe_run git commit -m "$COMMIT_MSG"
    fi

    # 2. æ¨é€å½“å‰åˆ†æ”¯
    print_message "æ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“..."
    safe_run git push origin "$ORIGINAL_BRANCH"

    # 3. åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯
    safe_checkout "$target_branch" true

    # 4. æ‹‰å–æœ€æ–°ä»£ç 
    print_message "æ‹‰å–ç›®æ ‡åˆ†æ”¯æœ€æ–°ä»£ç ..."
    safe_run git pull origin "$target_branch"

    # 5. åˆå¹¶æºåˆ†æ”¯
    local merge_strategy
    merge_strategy=$(jq -r '.merge_strategy' "$CONFIG_FILE")
    safe_merge "$ORIGINAL_BRANCH" "$merge_strategy"

    # 6. æ¨é€åˆå¹¶ç»“æœ
    print_message "æ¨é€åˆå¹¶ç»“æœåˆ°è¿œç¨‹ä»“åº“..."
    safe_run git push origin "$target_branch"

    # 7. åˆ‡æ¢å›åŸåˆ†æ”¯
    safe_checkout "$ORIGINAL_BRANCH"

    print_success "æ‰€æœ‰æ“ä½œæ‰§è¡Œå®Œæˆ âœ…"
    print_success "åˆ†æ”¯ $ORIGINAL_BRANCH å·²æˆåŠŸåˆå¹¶åˆ° $target_branch"
}

# ===================================
# ä¸»ç¨‹åº
# ===================================

main() {
    # è§£æå‘½ä»¤è¡Œå‚æ•°
    while [[ $# -gt 0 ]]; do
        case $1 in
            -h|--help)
                show_help
                exit 0
                ;;
            -v|--verbose)
                VERBOSE=true
                shift
                ;;
            -d|--dry-run)
                DRY_RUN=true
                shift
                ;;
            -a|--auto)
                AUTO_MODE=true
                shift
                ;;
            -c|--commit)
                COMMIT_MSG="$2"
                shift 2
                ;;
            -e|--env)
                TARGET_ENV="$2"
                shift 2
                ;;
            --config)
                load_config
                edit_config
                exit 0
                ;;
            --list-envs)
                load_config
                list_environments
                exit 0
                ;;
            --version)
                show_version
                exit 0
                ;;
            *)
                print_error "æœªçŸ¥é€‰é¡¹: $1"
                show_help
                exit 1
                ;;
        esac
    done

    # æ˜¾ç¤ºè„šæœ¬æ ‡é¢˜
    echo -e "${PURPLE}======================================${NC}"
    echo -e "${PURPLE}    Git åˆ†æ”¯åˆå¹¶è‡ªåŠ¨åŒ–å·¥å…· v$SCRIPT_VERSION    ${NC}"
    echo -e "${PURPLE}======================================${NC}"

    # åŠ è½½é…ç½®
    load_config

    # éªŒè¯Gitä»“åº“
    validate_git_repo

    # è·å–å½“å‰åˆ†æ”¯
    ORIGINAL_BRANCH=$(git branch --show-current)
    print_message "å½“å‰åˆ†æ”¯: ${YELLOW}$ORIGINAL_BRANCH${NC}"

    # è·å–ç”¨æˆ·è¾“å…¥
    get_user_input

    # æ˜¾ç¤ºæ“ä½œæ‘˜è¦
    show_summary

    # æ‰§è¡Œåˆå¹¶æ“ä½œ
    execute_merge
}

# è¿è¡Œä¸»ç¨‹åº
main "$@"
```

</details>

---
